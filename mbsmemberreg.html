<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBS Member Registration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    
    <style>
        :root {
            --main-color: #007bff; /* PPS Blue */
            --bg-color: #e7f1ff;   /* Soft Blue */
        }

        body {
            background-color: var(--bg-color);
            transition: background-color 0.5s ease;
            font-family: 'Segoe UI', sans-serif;
            padding: 20px 0;
        }

        /* Borang kekal putih tawar */
        .card {
            background-color: #ffffff !important;
            border: none;
            border-top: 10px solid var(--main-color);
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            max-width: 700px;
            margin: auto;
            transition: border-color 0.5s ease;
        }

        /* Paksa semua input jadi Huruf Besar secara visual */
        input[type="text"], textarea, .form-select {
            text-transform: uppercase;
        }

        .form-label {
            font-weight: bold;
            font-size: 0.9rem;
            color: #333;
        }

        .fixed-country {
            background-color: #e9ecef !important;
            color: #6c757d;
            font-weight: bold;
        }

        #signature-pad {
            border: 2px dashed #ccc;
            background: #fff;
            width: 100%;
            height: 200px;
        }

        .btn-primary {
            background-color: var(--main-color) !important;
            border-color: var(--main-color) !important;
            font-weight: bold;
        }

        .tnc-text {
            height: 150px;
            overflow-y: scroll;
            font-size: 11px;
            background: #f9f9f9;
            padding: 10px;
            border: 1px solid #ddd;
            margin-bottom: 10px;
            text-align: justify;
        }

        #loader {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.8);
            z-index: 9999;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>

<div id="loader">
    <div class="spinner-border text-primary"></div>
    <div class="mt-2 fw-bold">SEDANG MEMPROSES...</div>
</div>

<div class="container">
    <div class="card p-4">
        <h3 class="text-center mb-4" style="color: var(--main-color);">MBS MEMBER REGISTRATION</h3>
        
        <form id="regForm">
            <div class="mb-3">
                <label class="form-label">JENIS MEMBER:</label>
                <select class="form-select" id="type" onchange="updateTheme()">
                    <option value="PPS" selected>PPS (BLUE - DEFAULT)</option>
                    <option value="RED">RED</option>
                    <option value="SKYBLUE">SKYBLUE</option>
                    <option value="BLACK">BLACK</option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">MEMBER CARD NO:</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="cardNo" placeholder="SCAN ATAU TAIP NO KAD" required>
                    <button class="btn btn-outline-secondary" type="button">ðŸ“· SCAN</button>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">NAMA PENUH:</label>
                <input type="text" class="form-control" id="nama" required>
            </div>

            <div class="row">
                <div class="col-6 mb-3">
                    <label class="form-label">NOMBOR IC:</label>
                    <input type="text" class="form-control" id="ic" required>
                </div>
                <div class="col-6 mb-3">
                    <label class="form-label">HANDPHONE:</label>
                    <input type="tel" class="form-control" id="phone" required>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">ALAMAT:</label>
                <textarea class="form-control" id="alamat" rows="2" required></textarea>
            </div>

            <div class="row">
                <div class="col-4 mb-3">
                    <label class="form-label">POSTCODE:</label>
                    <input type="text" class="form-control" id="postcode" required>
                </div>
                <div class="col-4 mb-3">
                    <label class="form-label">CITY:</label>
                    <input type="text" class="form-control" id="city" required>
                </div>
                <div class="col-4 mb-3">
                    <label class="form-label">STATE:</label>
                    <select class="form-select" id="state" required>
    <option value="" disabled selected>PILIH NEGERI</option>
    <option value="JOHOR">JOHOR</option>
    <option value="KEDAH">KEDAH</option>
    <option value="KELANTAN">KELANTAN</option>
    <option value="MELAKA">MELAKA</option>
    <option value="NEGERI SEMBILAN">NEGERI SEMBILAN</option>
    <option value="PAHANG">PAHANG</option>
    <option value="PERAK">PERAK</option>
    <option value="PERLIS">PERLIS</option>
    <option value="PULAU PINANG">PULAU PINANG</option>
    <option value="SABAH">SABAH</option>
    <option value="SARAWAK">SARAWAK</option>
    <option value="SELANGOR">SELANGOR</option>
    <option value="TERENGGANU">TERENGGANU</option>
    <option value="W.P. KUALA LUMPUR">W.P. KUALA LUMPUR</option>
    <option value="W.P. LABUAN">W.P. LABUAN</option>
    <option value="W.P. PUTRAJAYA">W.P. PUTRAJAYA</option>
</select>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">COUNTRY:</label>
                <input type="text" class="form-control fixed-country" value="MALAYSIA" readonly>
            </div>

            <div class="mb-4">
                <label class="form-label">BIL ANAK MASIH BELAJAR:</label>
                <input type="number" class="form-control" id="anak" value="0">
            </div>

            <button type="button" class="btn btn-primary w-100 py-3" onclick="openTnC()">SETERUSNYA: PENGESAHAN & SIGNATURE</button>
        </form>
    </div>
</div>

<div class="modal fade" id="tncModal" data-bs-backdrop="static" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body p-4">
                <h5 class="mb-3">PENGAKUAN & SYARAT</h5>
                <div class="tnc-text">
                    I agree to participate & abide at MBS Books & Stationery Pahang Pride Discount Card Term & Conditions. I hereby confirm that all my personal information stated above is true and complete. I hereby irrevocably consent and authorized MBS Books & Stationery to process any of my information and to release the same to any related and/or associate company within the MBS Books & Stationery existing of future business partners of strategic alliances and/or any other 3rd party as MBS may in its absolute discretion deem necessary or expedient for the purpose of marketing and promotion of products and services. I hereby confirm that no future permission or consent from me is necessary of required in relation there to and this shall constitute the consent required under the Personal Data Protection Act 2010 and any other contractual consert for such disclosure of information.
                    <br><br>
                    Saya bersetuju untuk menyertai & mematuhi Terma & Syarat Kad Diskaun MBS Books & Stationery Pahang Pride. Saya dengan ini mengesahkan bahawa semua maklumat peribadi saya yg dinyatakan diatas adalah benar & lengkap. Saya dengan ini secara tidak boleh membatalkan kebenaran & member kuasa kepada MBS Books & Stationery untuk memproses mana-mana maklumat saya dan untuk mengeluarkannya kepada mana-mana syarikat berkaitan dan.atau bersekutu dalam MBS Books & Stationery,perniaagan masa hadapan MBS yang sedia ada, rakan kongsi pakatan startegik dan/atau mana-mana pihak ke-3 lain yg MBS mungkin menurut budi bicara mutlaknya perlu atau suai manfaat untuk tujuan pemasaran dan promosi produk & perkhidmatan. Saya dengan ini mengesahkan bahawa tiada kebenaran masa depan a tau persetujuan daripada saya diperlukan berhubung dengannya dan ini akan membentuk persetujuan yg diperlukan berhubung dengannya dan ini akan membentuk persetujuan yg diperlukan di bawah Akta Perlindungan Data Peribadi 2010 dan sebarang persetujuan kontrak lain untuk pendedahan maklumat sedemikian.
                </div>
                
                <label class="form-label mt-3">TANDATANGAN:</label>
                <canvas id="signature-pad"></canvas>
                <button class="btn btn-link btn-sm text-danger p-0" onclick="signaturePad.clear()">Padam Semula</button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">BATAL</button>
                <button type="button" class="btn btn-primary" id="btnSubmit" onclick="hantarData()">SAHKAN & HANTAR</button>
            </div>
        </div>
    </div>
</div>

<script>
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyWu_EnJEJeszS8tWOeACSzg9mlWGHOivWKA70-_7T449Kakqx78CX4jmi_Vf-_Zkw/exec";
    let signaturePad;
    const modal = new bootstrap.Modal(document.getElementById('tncModal'));

    window.onload = () => {
        const canvas = document.getElementById('signature-pad');
        signaturePad = new SignaturePad(canvas);
        
        function resizeCanvas() {
            const ratio = Math.max(window.devicePixelRatio || 1, 1);
            canvas.width = canvas.offsetWidth * ratio;
            canvas.height = canvas.offsetHeight * ratio;
            canvas.getContext("2d").scale(ratio, ratio);
            signaturePad.clear();
        }
        window.onresize = resizeCanvas;
        resizeCanvas();
    };

    function updateTheme() {
        const type = document.getElementById('type').value;
        const root = document.querySelector(':root');
        
        const themes = {
            'PPS': { main: '#007bff', bg: '#e7f1ff' },
            'RED': { main: '#dc3545', bg: '#f8d7da' },
            'SKYBLUE': { main: '#0dcaf0', bg: '#e0f7fa' },
            'BLACK': { main: '#212529', bg: '#dee2e6' }
        };

        root.style.setProperty('--main-color', themes[type].main);
        root.style.setProperty('--bg-color', themes[type].bg);
    }

    function openTnC() {
        const form = document.getElementById('regForm');
        if(!form.checkValidity()) {
            form.reportValidity();
            return;
        }
        modal.show();
    }

    async function hantarData() {
        if (signaturePad.isEmpty()) {
            alert("Sila turunkan tandatangan!");
            return;
        }

        document.getElementById('loader').style.display = 'flex';
        
        const formData = {
            type: document.getElementById('type').value,
            cardNo: document.getElementById('cardNo').value.toUpperCase(),
            nama: document.getElementById('nama').value.toUpperCase(),
            ic: document.getElementById('ic').value,
            phone: document.getElementById('phone').value,
            alamat: document.getElementById('alamat').value.toUpperCase(),
            postcode: document.getElementById('postcode').value,
            city: document.getElementById('city').value.toUpperCase(),
            state: document.getElementById('state').value,
            anak: document.getElementById('anak').value,
            signature: signaturePad.toDataURL()
        };

        try {
            const response = await fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(formData)
            });
            const res = await response.json();
            
            if (res.result === "success") {
                alert("PENDAFTARAN BERJAYA!");
                window.open(res.downloadUrl, '_blank');
                location.reload();
            } else {
                alert("RALAT: " + res.message);
            }
        } catch (e) {
            alert("Sila semak Google Sheet anda. Data sedang diproses.");
            location.reload();
        }
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>